<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backtrader 交易机器人管理端</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Backtrader 交易机器人管理端</h1>

    <div class="input-group">
        <label for="strategy">交易策略:</label>
        <select id="strategy">
            <option value="smacross">双均线交叉</option>
            <option value="macd">MACD</option>
        </select>

        <label for="initialCash">初始资金:</label>
        <input type="number" id="initialCash" value="100000">

        <label for="commission">佣金比例:</label>
        <input type="number" id="commission" value="0.001" step="0.0001">

        <label for="stockCode">股票代码:</label>
        <input type="text" id="stockCode" value="000858.SZ">
    </div>

    <div class="button-group">
        <button id="startButton">启动机器人</button>
    </div>

    <div id="log">日志将显示在这里...</div>

    <textarea id="historical-data-textarea" readonly></textarea>
    <textarea id="profit-info-textarea" readonly></textarea>

    <script>
        const startButton = document.getElementById('startButton');
        const log = document.getElementById('log');
        const initialCashInput = document.getElementById('initialCash');
        const commissionInput = document.getElementById('commission');
        const stockCodeInput = document.getElementById('stockCode');
        const strategySelect = document.getElementById('strategy');
        const sockets = [];

        startButton.addEventListener('click', () => {
            const strategy = strategySelect.value;
            const initialCash = parseFloat(initialCashInput.value);
            const commission = parseFloat(commissionInput.value);
            const stockCode = stockCodeInput.value;

            const url = `ws://localhost:5000/ws?strategy=${strategy}&initialCash=${initialCash}&commission=${commission}&stockCode=${stockCode}`;
            const socket = new WebSocket(url);
            sockets.push(socket);

            const logEntry = document.createElement('p');
            logEntry.textContent = `机器人 (策略: ${strategy}, 初始资金: ${initialCash}, 佣金比例: ${commission}, 股票代码: ${stockCode}) 已启动...`;
            log.appendChild(logEntry);

            socket.onopen = () => {
                console.log('WebSocket 连接成功');
                logEntry.textContent += ' 连接成功';
            };

            socket.onmessage = (event) => {
                console.log('收到消息:', event.data);
                const messageLog = document.createElement('p');
                messageLog.textContent = `机器人 (${strategy}策略): ${event.data}`;
                log.appendChild(messageLog);

                // 将收到的历史数据显示在 textarea 中
                const historicalDataTextarea = document.getElementById('historical-data-textarea');
                historicalDataTextarea.value += event.data + '\n';
            };

            socket.onerror = (error) => {
                console.error('WebSocket 连接出错:', error);
                logEntry.textContent += ' 连接出错，请检查控制台日志';
            };

            socket.onclose = () => {
                logEntry.textContent = `机器人 (策略: ${strategy}, 初始资金: ${initialCash}, 佣金比例: ${commission}, 股票代码: ${stockCode}) 已停止...`;
            };
        });
    </script>
</body>
</html>

